<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Personal Site</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta name="description" content="Personal portfolio and documentation site">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
  <!-- Theme -->
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/docsify@4/lib/themes/vue.css">
  <!-- Custom CSS -->
  <style>
    :root {
      --theme-color: #3F51B5;
    }
    
    /* Collapsible sidebar sections styling */
    .sidebar-nav li.collapsible > a::before {
      content: '▼';
      display: inline-block;
      margin-right: 6px;
      transition: transform 0.3s;
      font-size: 0.8em;
    }
    
    .sidebar-nav li.collapsible.collapsed > a::before {
      transform: rotate(-90deg);
    }
    
    .sidebar-nav li.collapsible.collapsed > ul {
      display: none;
    }
    
    .sidebar-nav li.collapsible > a {
      cursor: pointer;
      user-select: none;
    }
    
    /* Optional: Add hover effect for collapsible sections */
    .sidebar-nav li.collapsible > a:hover {
      background-color: rgba(0, 0, 0, 0.05);
    }
    
    /* Larger font size for major sections */
    .sidebar-nav > ul > li > a,
    .sidebar-nav > ul > li > p,
    .sidebar-nav > ul > li > strong {
      font-size: 1.1em;
      font-weight: 600;
    }
    
    /* Make the main section headers more prominent */
    .sidebar-nav li.collapsible > a strong,
    .sidebar-nav li.collapsible > p strong {
      font-size: 1.05em;
      color: var(--theme-color);
    }
    
    /* Sidebar text styling */
    /* Level 1 - Main sections (Academic, Professional, etc.) */
    .sidebar-nav > ul > li > a,
    .sidebar-nav > ul > li > p,
    .sidebar-nav > ul > li > strong {
      color: #1a1a1a;
      font-weight: 600;
      font-size: 1.05em;
      letter-spacing: 0.3px;
    }
    
    /* Level 2 - Subsections (Institutions, Experiences, etc.) */
    .sidebar-nav > ul > li > ul > li > a,
    .sidebar-nav > ul > li > ul > li > p,
    .sidebar-nav > ul > li > ul > li > strong {
      color: #4a4a4a;
      font-weight: 500;
      font-size: 0.95em;
    }
    
    /* Level 3 - Sub-subsections (Engineering, Medicine, Technology) */
    .sidebar-nav > ul > li > ul > li > ul > li > a,
    .sidebar-nav > ul > li > ul > li > ul > li > p,
    .sidebar-nav > ul > li > ul > li > ul > li > strong {
      color: #6a6a6a;
      font-weight: 500;
      font-size: 0.92em;
      font-style: italic;
    }
    
    /* Level 4 - Individual pages (FE Exam, Patent Bar, etc.) */
    .sidebar-nav > ul > li > ul > li > ul > li > ul > li > a {
      color: #505050;
      font-weight: 400;
      font-size: 0.9em;
    }
    
    /* Add small indent indicators */
    .sidebar-nav > ul > li > ul > li > ul > li > ul > li > a::before {
      content: "→ ";
      color: #b0b0b0;
      font-size: 0.8em;
    }
    
    /* Hover effects for all levels */
    .sidebar-nav a:hover {
      color: var(--theme-color) !important;
      background-color: rgba(63, 81, 181, 0.08);
      padding-left: 20px;
      transition: all 0.2s ease;
    }
    
    /* Active/current page highlight */
    .sidebar-nav .active > a {
      color: var(--theme-color) !important;
      font-weight: 600;
      border-left: 3px solid var(--theme-color);
      padding-left: 12px;
    }
  </style>
</head>
<body>
  <div id="app"></div>
  <script>
    window.$docsify = {
      name: 'Personal Site',
      repo: '',
      coverpage: false,
      loadSidebar: true,
      subMaxLevel: 3,
      auto2top: false,
      relativePath: false,
      alias: {
        '/.*/_sidebar.md': '/_sidebar.md'
      },
      search: {
        maxAge: 86400000,
        paths: 'auto',
        placeholder: 'Search',
        noData: 'No Results',
        depth: 3
      },
      pagination: {
        previousText: 'Previous',
        nextText: 'Next',
        crossChapter: true,
        crossChapterText: true,
      },
      markdown: {
        renderer: {
          code: function(code, lang) {
            return this.origin.code.apply(this, arguments);
          }
        }
      }
    }
  </script>
  <!-- Docsify v4 -->
  <script src="//cdn.jsdelivr.net/npm/docsify@4"></script>
  <!-- Plugins -->
  <script src="//cdn.jsdelivr.net/npm/docsify/lib/plugins/search.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/docsify-pagination/dist/docsify-pagination.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/prismjs@1/components/prism-markdown.min.js"></script>
  
  <!-- Custom script for collapsible sections -->
  <script>
    // Function to make sections collapsible
    function initCollapsibleSections() {
      const sidebar = document.querySelector('.sidebar-nav');
      if (!sidebar) {
        setTimeout(initCollapsibleSections, 100);
        return;
      }
      
      // Clear any old localStorage keys from previous naming
      Object.keys(localStorage).forEach(key => {
        if (key.startsWith('sidebar-') && key.includes('Section')) {
          localStorage.removeItem(key);
        }
      });
      
      // Find all list items in the sidebar
      const allListItems = sidebar.querySelectorAll('li');
      
      allListItems.forEach(li => {
        // Skip if already processed (has collapsible class)
        if (li.classList.contains('collapsible')) {
          return;
        }
        
        // Check if this li or its immediate children contain {collapsible} marker
        const hasCollapsible = li.innerHTML.includes('{collapsible}');
        
        if (hasCollapsible) {
          // Look for nested UL in different possible locations
          let nestedUl = null;
          
          // Strategy 1: Direct child UL
          for (let child of li.children) {
            if (child.tagName === 'UL') {
              nestedUl = child;
              break;
            }
          }
          
          // Strategy 2: UL after a P or STRONG element (common Docsify structure)
          if (!nestedUl) {
            const strongOrP = li.querySelector('strong, p');
            if (strongOrP && strongOrP.nextElementSibling && strongOrP.nextElementSibling.tagName === 'UL') {
              nestedUl = strongOrP.nextElementSibling;
            }
          }
          
          // Strategy 3: Next sibling of the li that is a UL (for some markdown structures)
          if (!nestedUl && li.nextElementSibling && li.nextElementSibling.tagName === 'UL') {
            // This UL might belong to this LI, move it inside
            nestedUl = li.nextElementSibling;
            li.appendChild(nestedUl);
          }
          
          // Strategy 4: Any UL inside the li
          if (!nestedUl) {
            nestedUl = li.querySelector('ul');
          }
          
          if (!nestedUl) {
            console.log('No nested UL found for:', li.textContent.substring(0, 50));
            return;
          }
          
          // Find and clean all text nodes and elements containing {collapsible}
          const cleanCollapsibleText = (element) => {
            // Clean text in all child nodes
            element.childNodes.forEach(node => {
              if (node.nodeType === Node.TEXT_NODE) {
                if (node.textContent.includes('{collapsible}')) {
                  node.textContent = node.textContent.replace(/\s*\{collapsible\}/g, '');
                }
              } else if (node.nodeType === Node.ELEMENT_NODE && !node.matches('ul')) {
                // Recursively clean child elements but skip ul elements
                if (node.textContent.includes('{collapsible}')) {
                  cleanCollapsibleText(node);
                }
              }
            });
            
            // Clean the element's own text if it's a text container
            if (element.tagName === 'STRONG' || element.tagName === 'P' || element.tagName === 'A') {
              if (element.childNodes.length === 1 && element.firstChild.nodeType === Node.TEXT_NODE) {
                element.firstChild.textContent = element.firstChild.textContent.replace(/\s*\{collapsible\}/g, '');
              }
            }
          };
          
          // Clean the li element
          cleanCollapsibleText(li);
          
          // Find the section header after cleaning
          let headerElement = li.querySelector('strong');
          if (!headerElement) {
            headerElement = li.querySelector('p');
          }
          if (!headerElement) {
            // Look for link elements that might contain the header
            const linkElement = li.querySelector('a');
            if (linkElement && !linkElement.closest('ul')) {
              headerElement = linkElement;
            }
          }
          
          if (headerElement) {
            // Add collapsible class to li
            li.classList.add('collapsible');
            
            // Get section name for storage
            const sectionName = headerElement.textContent.trim();
            
            // Check stored state
            const storedState = localStorage.getItem('sidebar-' + sectionName);
            let isCollapsed;
            
            // Check if we're coming from the homepage for the first time this session
            const isFirstVisit = !sessionStorage.getItem('sidebar-initialized');
            const isFromHomepage = document.referrer.includes('index.html') || 
                                  document.referrer === window.location.origin + '/';
            
            if (isFirstVisit && isFromHomepage) {
              // First visit from homepage - use default behavior
              isCollapsed = sectionName !== 'Introduction';  // Only Introduction starts expanded
              sessionStorage.setItem('sidebar-initialized', 'true');
            } else if (storedState !== null) {
              // Use saved preference
              isCollapsed = storedState === 'collapsed';
            } else {
              // No saved preference - use defaults
              isCollapsed = sectionName !== 'Introduction';
            }
            if (isCollapsed) {
              li.classList.add('collapsed');
            }
            
            // Make header clickable
            headerElement.style.cursor = 'pointer';
            headerElement.style.userSelect = 'none';
            
            // Add click handler
            headerElement.addEventListener('click', function(e) {
              e.preventDefault();
              e.stopPropagation();
              li.classList.toggle('collapsed');
              
              // Save state
              const state = li.classList.contains('collapsed') ? 'collapsed' : 'expanded';
              localStorage.setItem('sidebar-' + sectionName, state);
              
              console.log('Toggled:', sectionName, 'to', state);
            });
            
            console.log('Made collapsible:', sectionName, '- Has UL:', !!nestedUl, '- UL children:', nestedUl ? nestedUl.children.length : 0);
          }
        }
      });
      
      // Log summary and detailed info
      const collapsibleCount = sidebar.querySelectorAll('li.collapsible').length;
      console.log('Total collapsible sections:', collapsibleCount);
      
      // Debug: List all collapsible sections
      sidebar.querySelectorAll('li.collapsible').forEach(li => {
        const header = li.querySelector('strong, p, a');
        const ul = li.querySelector('ul');
        if (header) {
          console.log('Collapsible:', header.textContent.trim(), '- Has nested UL:', !!ul, '- Items:', ul ? ul.children.length : 0);
        }
      });
    }
    
    // Initialize when Docsify loads
    if (window.$docsify && window.$docsify.plugins) {
      window.$docsify.plugins = [].concat(window.$docsify.plugins || [], function(hook) {
        hook.doneEach(function() {
          // This runs after each page navigation
          setTimeout(initCollapsibleSections, 50);
        });
      });
    } else {
      // Fallback if plugins aren't ready
      document.addEventListener('DOMContentLoaded', function() {
        setTimeout(initCollapsibleSections, 500);
      });
    }
  </script>
</body>
</html>