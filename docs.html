<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Personal Site</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta name="description" content="Personal portfolio and documentation site">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
  <!-- Theme -->
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/docsify@4/lib/themes/vue.css">
  <!-- Custom CSS -->
  <style>
    :root {
      --theme-color: #3F51B5;
    }
    
    /* Collapsible sidebar sections styling */
    .sidebar-nav li.collapsible > a::before {
      content: 'â–¼';
      display: inline-block;
      margin-right: 6px;
      transition: transform 0.3s;
      font-size: 0.8em;
    }
    
    .sidebar-nav li.collapsible.collapsed > a::before {
      transform: rotate(-90deg);
    }
    
    .sidebar-nav li.collapsible.collapsed > ul {
      display: none;
    }
    
    .sidebar-nav li.collapsible > a {
      cursor: pointer;
      user-select: none;
    }
    
    /* Optional: Add hover effect for collapsible sections */
    .sidebar-nav li.collapsible > a:hover {
      background-color: rgba(0, 0, 0, 0.05);
    }
    
    /* Larger font size for major sections */
    .sidebar-nav > ul > li > a,
    .sidebar-nav > ul > li > p,
    .sidebar-nav > ul > li > strong {
      font-size: 1.1em;
      font-weight: 600;
    }
    
    /* Make the main section headers more prominent */
    .sidebar-nav li.collapsible > a strong,
    .sidebar-nav li.collapsible > p strong {
      font-size: 1.05em;
      color: var(--theme-color);
    }
  </style>
</head>
<body>
  <div id="app"></div>
  <script>
    window.$docsify = {
      name: 'Personal Site',
      repo: '',
      coverpage: false,
      loadSidebar: true,
      subMaxLevel: 3,
      auto2top: false,
      alias: {
        '/.*/_sidebar.md': '/_sidebar.md'
      },
      search: {
        maxAge: 86400000,
        paths: 'auto',
        placeholder: 'Search',
        noData: 'No Results',
        depth: 3
      },
      pagination: {
        previousText: 'Previous',
        nextText: 'Next',
        crossChapter: true,
        crossChapterText: true,
      },
      markdown: {
        renderer: {
          code: function(code, lang) {
            return this.origin.code.apply(this, arguments);
          }
        }
      }
    }
  </script>
  <!-- Docsify v4 -->
  <script src="//cdn.jsdelivr.net/npm/docsify@4"></script>
  <!-- Plugins -->
  <script src="//cdn.jsdelivr.net/npm/docsify/lib/plugins/search.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/docsify-pagination/dist/docsify-pagination.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/prismjs@1/components/prism-markdown.min.js"></script>
  
  <!-- Custom script for collapsible sections -->
  <script>
    // Function to make sections collapsible
    function initCollapsibleSections() {
      const sidebar = document.querySelector('.sidebar-nav');
      if (!sidebar) {
        setTimeout(initCollapsibleSections, 100);
        return;
      }
      
      // Clear any old localStorage keys from previous naming
      Object.keys(localStorage).forEach(key => {
        if (key.startsWith('sidebar-') && key.includes('Section')) {
          localStorage.removeItem(key);
        }
      });
      
      // Find all list items in the sidebar
      const allListItems = sidebar.querySelectorAll('li');
      
      allListItems.forEach(li => {
        // Check if this li contains {collapsible} marker
        if (li.innerHTML.includes('{collapsible}')) {
          // Get the nested ul if it exists
          const nestedUl = li.querySelector('ul');
          if (!nestedUl) return;
          
          // Find the section header (could be in strong, p, or direct text)
          let headerElement = li.querySelector('strong');
          if (!headerElement) {
            headerElement = li.querySelector('p');
          }
          
          // Remove {collapsible} from just the header element without destroying the structure
          if (headerElement && headerElement.textContent.includes('{collapsible}')) {
            headerElement.textContent = headerElement.textContent.replace(/\s*\{collapsible\}/g, '');
          } else {
            // If not in header, search in text nodes
            Array.from(li.childNodes).forEach(node => {
              if (node.nodeType === Node.TEXT_NODE && node.textContent.includes('{collapsible}')) {
                node.textContent = node.textContent.replace(/\s*\{collapsible\}/g, '');
              }
            });
          }
          
          if (!headerElement) {
            // Create a span for direct text nodes
            const firstTextNode = Array.from(li.childNodes).find(n => n.nodeType === Node.TEXT_NODE && n.textContent.trim());
            if (firstTextNode) {
              headerElement = document.createElement('span');
              headerElement.textContent = firstTextNode.textContent.replace(/\s*\{collapsible\}/g, '');
              li.replaceChild(headerElement, firstTextNode);
            }
          }
          
          if (headerElement) {
            // Add collapsible class to li
            li.classList.add('collapsible');
            
            // Get section name for storage
            const sectionName = headerElement.textContent.trim();
            
            // Check if we're coming from the homepage or it's a fresh visit
            const isFromHomepage = document.referrer.includes('index.html') || 
                                  document.referrer === window.location.origin + '/' ||
                                  !sessionStorage.getItem('sidebar-initialized');
            
            // Check stored state
            const storedState = localStorage.getItem('sidebar-' + sectionName);
            let isCollapsed;
            
            if (isFromHomepage) {
              // Coming from homepage - use default behavior regardless of stored state
              isCollapsed = sectionName !== 'Introduction';  // Only Introduction starts expanded
              // Mark that we've initialized the sidebar for this session
              sessionStorage.setItem('sidebar-initialized', 'true');
            } else if (storedState === null) {
              // No saved preference and not from homepage - use defaults
              isCollapsed = sectionName !== 'Introduction';
            } else {
              // Use saved preference (when navigating within docs)
              isCollapsed = storedState === 'collapsed';
            }
            if (isCollapsed) {
              li.classList.add('collapsed');
            }
            
            // Make header clickable
            headerElement.style.cursor = 'pointer';
            headerElement.style.userSelect = 'none';
            
            // Add click handler
            headerElement.addEventListener('click', function(e) {
              e.preventDefault();
              e.stopPropagation();
              li.classList.toggle('collapsed');
              
              // Save state
              const state = li.classList.contains('collapsed') ? 'collapsed' : 'expanded';
              localStorage.setItem('sidebar-' + sectionName, state);
            });
            
            console.log('Made collapsible:', sectionName);
          }
        }
      });
      
      // Log summary
      const collapsibleCount = sidebar.querySelectorAll('li.collapsible').length;
      console.log('Total collapsible sections:', collapsibleCount);
    }
    
    // Initialize when Docsify loads
    if (window.$docsify && window.$docsify.plugins) {
      window.$docsify.plugins = [].concat(window.$docsify.plugins || [], function(hook) {
        hook.doneEach(function() {
          setTimeout(initCollapsibleSections, 50);
        });
      });
    } else {
      // Fallback if plugins aren't ready
      document.addEventListener('DOMContentLoaded', function() {
        setTimeout(initCollapsibleSections, 500);
      });
    }
  </script>
</body>
</html>